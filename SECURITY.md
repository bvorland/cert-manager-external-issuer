# Security Policy

## Security Model

The External PKI Issuer follows security best practices for Kubernetes controllers:

### Container Security

- **Non-root execution**: Container runs as user 65532 (nonroot)
- **Read-only filesystem**: Root filesystem is read-only
- **No privilege escalation**: `allowPrivilegeEscalation: false`
- **Dropped capabilities**: All Linux capabilities are dropped
- **Seccomp profile**: Uses RuntimeDefault seccomp profile
- **Distroless base image**: Minimal attack surface using `gcr.io/distroless/static:nonroot`

### RBAC (Role-Based Access Control)

The controller uses minimal permissions following the principle of least privilege:

| Resource | Permissions | Purpose |
|----------|-------------|---------|
| CertificateRequests | get, list, watch | Monitor signing requests |
| CertificateRequests/status | get, patch | Update with signed certificates |
| ExternalIssuers | get, list, watch | Read issuer configuration |
| ExternalClusterIssuers | get, list, watch | Read cluster issuer configuration |
| ConfigMaps | get, list, watch | Read PKI API configuration |
| Secrets | get, list, watch | Read authentication credentials |
| Events | create, patch | Emit Kubernetes events |
| Leases | get, list, watch, create, update, patch, delete | Leader election |

**Important**: The controller does NOT have permissions to:
- Approve CertificateRequests (handled by cert-manager's approver)
- Create or modify Secrets (cert-manager creates TLS secrets)
- Access arbitrary resources

### Secrets Management

- PKI API credentials are stored in Kubernetes Secrets, never in ConfigMaps
- Private keys are generated by cert-manager and never leave the cluster
- Only CSRs (public key material) are sent to external PKI APIs

### Network Security

- All PKI API calls use HTTPS
- TLS certificate verification is enabled by default
- `insecureSkipVerify` should only be used for testing with self-signed PKI certificates
- Consider using Network Policies to restrict egress traffic to PKI endpoints only

### Recommendations

1. **Production environments**:
   - Always enable TLS verification (`insecureSkipVerify: false`)
   - Use strong authentication for PKI APIs (mTLS, API tokens with short lifetimes)
   - Rotate credentials regularly
   - Use NetworkPolicies to restrict controller egress

2. **Secrets handling**:
   - Consider using external-secrets-operator or sealed-secrets for credential management
   - Use Azure Key Vault, HashiCorp Vault, or similar for secret storage
   - Limit access to the external-issuer-system namespace

3. **Monitoring**:
   - Monitor controller logs for authentication failures
   - Set up alerts for certificate signing failures
   - Use cert-manager's Prometheus metrics for certificate expiration monitoring

## Reporting a Vulnerability

If you discover a security vulnerability, please report it responsibly:

1. **Do NOT** open a public GitHub issue for security vulnerabilities
2. Email security concerns to the repository maintainers
3. Include detailed steps to reproduce the vulnerability
4. Allow time for the vulnerability to be addressed before public disclosure

## Security Updates

Security updates will be released as patch versions. Subscribe to repository releases to be notified of security fixes.
